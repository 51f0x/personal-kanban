# Environment Configuration Template
# 
# This project uses separate environment files for different services:
# - .env          - Shared variables (database, Redis, LLM, SMTP, S3, observability)
# - .env.api      - API-specific variables (server, security, rate limiting, IMAP)
# - .env.worker   - Worker-specific variables (service URLs, email reminders)
# - .env.web      - Web/frontend variables (VITE_* variables)
#
# Copy this template to create your environment files:
#   cp env.template .env
#   cp env.template .env.api
#   cp env.template .env.worker
#   cp env.template .env.web
#
# Then edit each file to include only the relevant variables for that service.
#
# Note: For the web app, Vite loads .env files from apps/web/, so you may need to:
#   - Copy .env.web to apps/web/.env, or
#   - Create a symlink: ln -s ../../.env.web apps/web/.env
#
# ============================================================================
# SHARED VARIABLES (.env)
# ============================================================================

# Environment
NODE_ENV=development

# Database
# Consolidated database with separate schemas
# In Docker: postgresql://kanban:kanban@postgres:5432/kanban?schema=api
# Local dev: postgresql://kanban:kanban@localhost:5432/kanban?schema=api
API_DATABASE_URL=postgresql://kanban:kanban@postgres.github-com-51f0x-personal-kanban.orb.local:5432/kanban?schema=api

# Worker Database (uses worker schema in same database)
# In Docker: postgresql://kanban:kanban@postgres:5432/kanban?schema=worker
# Local dev: postgresql://kanban:kanban@localhost:5432/kanban?schema=worker
WORKER_DATABASE_URL=postgresql://kanban:kanban@postgres.github-com-51f0x-personal-kanban.orb.local:5432/kanban?schema=worker

# Legacy: DATABASE_URL (for backward compatibility)
# API container uses: API_DATABASE_URL or DATABASE_URL (defaults to api schema)
# Worker container uses: WORKER_DATABASE_URL or DATABASE_URL (defaults to worker schema)
DATABASE_URL=postgresql://kanban:kanban@localhost:5432/kanban?schema=api

# Redis
# Redis connection string (matches docker-compose.yml)
REDIS_URL=redis://localhost:6379

# SMTP (optional - for sending emails)
# Leave SMTP_HOST empty to disable SMTP
#
# For local development with Mailpit (recommended):
#   - If running services in Docker: SMTP_HOST=mailpit
#   - If running services locally: SMTP_HOST=localhost
#   - SMTP_PORT=1025 (Mailpit SMTP port)
#   - SMTP_SECURE=false
#   - No authentication needed (leave username/password empty)
#   - View emails at: http://localhost:8025
#
# For production, use your actual SMTP server:
#   SMTP_HOST=smtp.example.com
#   SMTP_PORT=587 (or 465 for SSL)
#   SMTP_SECURE=false (true for port 465)
#   SMTP_USERNAME=your-username
#   SMTP_PASSWORD=your-password
SMTP_HOST=localhost
SMTP_PORT=1025
SMTP_SECURE=false
SMTP_USERNAME=
SMTP_PASSWORD=
SMTP_FROM=noreply@localhost

# S3/Object Storage (optional - for attachments)
# Leave empty to disable S3 storage
# For local MinIO (from docker-compose.yml): http://localhost:9000
S3_ENDPOINT=
S3_BUCKET=kanban-attachments
S3_ACCESS_KEY=
S3_SECRET_KEY=

# LLM (optional - for automatic task analysis)
# Ollama endpoint URL (defaults to localhost, use http://ollama:11434 in docker-compose)
LLM_ENDPOINT=http://localhost:11434
# Ollama model to use (e.g., llama3.2:1b, llama3.2:3b, mistral:7b)
LLM_MODEL=llama3.2:1b

# Observability
OTEL_EXPORTER_OTLP_ENDPOINT=
LOG_LEVEL=info
LOG_FORMAT=pretty

# ============================================================================
# API-SPECIFIC VARIABLES (.env.api)
# ============================================================================

# Server
PORT=3000
API_HOST=0.0.0.0
CORS_ORIGIN=http://localhost:5173
WEB_URL=http://localhost:5173

# Redis
REDIS_QUEUE_PREFIX=pk

# Security
# Token for /capture endpoint authentication (used for both /capture and /capture/email)
# Generate a secure token for production: openssl rand -hex 32
CAPTURE_ACCESS_TOKEN=
# Token for internal service-to-service communication (worker <-> API)
# Generate a secure token for production: openssl rand -hex 32
INTERNAL_SERVICE_TOKEN=
SESSION_SECRET=change-me-in-production-min-16-chars
JWT_SECRET=change-me-in-production-min-16-chars
JWT_ACCESS_EXPIRY=15m
JWT_REFRESH_EXPIRY=7d

# Rate Limiting
RATE_LIMIT_TTL=60
RATE_LIMIT_MAX=100
CAPTURE_RATE_LIMIT_MAX=60

# IMAP (optional - for email ingestion)
# Leave empty to disable IMAP capture
IMAP_HOST=
IMAP_PORT=993
IMAP_SECURE=true
IMAP_USERNAME=
IMAP_PASSWORD=
IMAP_MAILBOX=INBOX
IMAP_POLL_INTERVAL_MS=60000
# These UUIDs should be set after creating a board and owner
IMAP_DEFAULT_BOARD_ID=
IMAP_DEFAULT_OWNER_ID=
IMAP_DEFAULT_COLUMN_ID=

# Email Capture (optional - for receiving tasks via email)
# Users can send emails to create tasks. The sender's email must match a registered user,
# and the task will be created on their default board.
# 
# To enable email capture:
# 1. Configure an email webhook service (SendGrid, AWS SES, Mailgun, etc.) to POST to:
#    POST https://your-api-domain.com/capture/email
#    Headers: x-capture-token: <your CAPTURE_ACCESS_TOKEN>
#    Body: JSON with email data (see API docs for EmailWebhookDto format)
# 
# 2. Ensure users have:
#    - Registered with their email address
#    - Set a default board in their account
# 
# 3. Users can then email tasks to the configured email address, and they will be
#    automatically converted to tasks on their default board.

# ============================================================================
# WORKER-SPECIFIC VARIABLES (.env.worker)
# ============================================================================

# Service URLs
API_URL=http://localhost:3000
WEB_URL=http://localhost:5173

# Email Reminders (optional - requires SMTP)
# Enable/disable email reminder worker
EMAIL_REMINDERS_ENABLED=true
# How often to send reminders (in hours, default: 24)
EMAIL_REMINDER_INTERVAL_HOURS=24
# Maximum number of tasks to include per email (default: 10)
EMAIL_MAX_TASKS_PER_EMAIL=10

# ============================================================================
# WEB/FRONTEND VARIABLES (.env.web)
# ============================================================================

# API Base URL
# Default: http://localhost:3000/api/v1
VITE_API_URL=http://localhost:3000/api/v1

# WebSocket URL for realtime updates
# Default: http://localhost:3000
VITE_WS_URL=http://localhost:3000

# Capture Token (optional)
# If set, this token will be included in capture requests
# Should match CAPTURE_ACCESS_TOKEN from the API .env.api file
VITE_CAPTURE_TOKEN=

# Default Owner ID (optional)
# Used for default board owner assignment
VITE_OWNER_ID=

